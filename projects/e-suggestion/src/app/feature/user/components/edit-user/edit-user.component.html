<div class="relative h-24 bg-gray-100 py-4">
  <button
    class="fa-solid fa-xmark absolute right-2 top-2 p-1 text-xl text-gray-400 ring-gray-400 transition-all duration-200 hover:text-gray-500"
    (click)="cancel()"></button>
  <img
    class="absolute bottom-[-20%] left-[50%] translate-x-[-50%] rounded-full border-2 border-primary-200 p-[.5px]"
    src="user-profile.png"
    width="70"
    height="70"
    alt="User Profile" />
</div>
<div class="p-4">
  <div class="border-b border-b-gray-300 py-3">
    @if (user(); as user) {
      <p class="text-[1em] font-semibold text-gray-700">
        {{ user.first_name | titlecase }} {{ user.last_name | titlecase }}
      </p>
      <p class="text-gray-500">{{ user.email }}</p>
    }
  </div>

  @defer {
    <form class="flex flex-col items-stretch gap-y-3 py-4" [formGroup]="form">
      <div class="flex items-center gap-x-2 border-b border-b-gray-300 py-3">
        <span class="w-1/6 font-semibold text-gray-600">Name</span>
        <div class="flex w-5/6 items-center gap-x-3">
          <ba-input class="flex-1" [control]="form.controls.first_name">
            <input
              type="text"
              formControlName="first_name"
              placeholder="First name" />
          </ba-input>

          <ba-input class="flex-1" [control]="form.controls.last_name">
            <input
              type="text"
              formControlName="last_name"
              placeholder="Last name" />
          </ba-input>
        </div>
      </div>

      <div class="flex items-center gap-x-2 border-b border-b-gray-300 py-3">
        <span class="w-1/6 font-semibold text-gray-600">TE Id</span>
        <ba-input class="flex-1" [control]="form.controls.te_id">
          <input
            type="text"
            id="te-id"
            formControlName="te_id"
            placeholder="TEXXXXXX"
            value="TE"
            pattern="TE\d{6}"
            title="TE Id should be in the format TEXXXXXX where X is a number." />
        </ba-input>
      </div>

      <div class="flex items-center gap-x-2 border-b border-b-gray-300 py-3">
        <span class="w-1/6 font-semibold text-gray-600">Email</span>
        <ba-input class="flex-1" [control]="form.controls.email">
          <input type="email" formControlName="email" placeholder="Email" />
        </ba-input>
      </div>

      <div class="flex items-center gap-x-2 border-b border-b-gray-300 py-3">
        <span class="w-1/6 font-semibold text-gray-600">Role</span>

        <p-select
          [options]="roles()"
          formControlName="role_id"
          optionLabel="name"
          optionValue="id"
          [filter]="false"
          filterBy="name"
          [showClear]="true"
          placeholder="Select a Role"
          class="flex-1"
          appendTo="body">
          <ng-template #selectedItem let-selectedOption>
            <div class="flex items-center gap-2">
              <div>{{ selectedOption.name | rolename }}</div>
            </div>
          </ng-template>
          <ng-template let-role #item>
            <div class="flex items-center gap-2">
              <div>{{ role.name | rolename }}</div>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="flex items-center gap-x-2 border-b border-b-gray-300 py-3">
        <span class="w-1/6 font-semibold text-gray-600">Department</span>

        <p-select
          [options]="departments()"
          formControlName="department_id"
          optionLabel="name"
          optionValue="id"
          [filter]="false"
          filterBy="name"
          [showClear]="true"
          placeholder="Select a Department"
          class="flex-1"
          appendTo="body">
          <ng-template #selectedItem let-selectedOption>
            <div class="flex items-center gap-2">
              <div>{{ selectedOption.name }}</div>
            </div>
          </ng-template>
          <ng-template let-department #item>
            <div class="flex items-center gap-2">
              <div>{{ department.name }}</div>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="flex items-center gap-x-2">
        <span class="w-1/6 font-semibold text-gray-600">BU & Plant</span>
        <div class="flex flex-1 items-center gap-x-2">
          <p-select
            [options]="bus()"
            formControlName="bu_id"
            optionLabel="name"
            optionValue="id"
            [filter]="false"
            [showClear]="true"
            placeholder="Select a BU"
            class="flex-1"
            appendTo="body">
            <!-- <ng-template #selectedItem let-selectedOption>
            <div class="flex items-center gap-2">
              <div>{{ selectedOption.name }}</div>
            </div>
          </ng-template>
          <ng-template let-bu #item>
            <div class="flex items-center gap-2">
              <div>{{ bu.name }}</div>
            </div>
          </ng-template> -->
          </p-select>

          <p-select
            [options]="plants()"
            formControlName="plant_id"
            optionLabel="name"
            optionValue="id"
            [filter]="false"
            filterBy="name"
            [showClear]="true"
            placeholder="Select a Plant"
            class="flex-1"
            appendTo="body">
            <!-- <ng-template #selectedItem let-selectedOption>
            <div class="flex items-center gap-2">
              <div>{{ selectedOption.name }}</div>
            </div>
          </ng-template>
          <ng-template let-plant #item>
            <div class="flex items-center gap-2">
              <div>{{ plant.name }}</div>
            </div>
          </ng-template> -->
          </p-select>
        </div>
      </div>
    </form>

    <!-- Actions -->
    <div
      class="flex w-full items-center justify-between border-t border-t-gray-300 py-3">
      <ba-button
        label="Delete User"
        icon="fa-trash"
        buttonClass="text-sm bg-red-50 ring-red-400 text-red-500 border border-red-100 hover:border-red-300 hover:bg-red-100"
        (onClick)="delete()"></ba-button>

      <div class="flex items-center gap-x-2">
        <ba-button
          label="Save Changes"
          icon="fa-floppy-disk"
          [disabled]="!form.valid"
          buttonClass="text-sm border border-gray-400 bg-primary-200 hover:bg-primary text-gray-50"
          (onClick)="saveChanges()" />
        <ba-button
          label="Cancel"
          buttonClass="text-sm text-gray-500 border border-gray-400 bg-neutral-50 hover:bg-neutral-100"
          (onClick)="cancel()" />
      </div>
    </div>
  } @placeholder (minimum 500ms) {
    <div class="p-10 text-center">
      <ba-loading />
    </div>
  }
</div>
